# Routers contain code beyond use for a rest.

# 

Routers user $P, which already has various methods and objects on it.   But if react called it, it wouldn’t be useful.  

A render function might return $P:
$P.render($P.views.dynamic(template)
$P.res.redirect(302, ‘/path’)
$P.exports.deal = deal

Then we can call render({$P}(

A rest requires creating an object that’s returned

Output.redirecPath = “/somepath”
Output.deal = deal
Return output


Layout

DealsController >> or deal >> calls endpoint.. 

Purchase flow

Can an account have prime without Recurly merely by not having been purchased? 

Subscribed
- recurly (auto-renew)
- Recurly item (once off)

Active, but will expired - cancelled
Expired
Paused


Types of prime


Pages
- server-side or client side served pages
- Handler controller for server pages:
- Www/custom + admin/custom - these are server-side pages
- Handlers export a route value (url like /answers) or just use the name of the file as this value.
- These route handlers call $P.render(template). 
- These templates (jade/pug) can be found at osmosis/templates
- Client side found in client/www/page - these use name of file for url

Endpoints
- these respond by $P.json({k:v}). 
- Found in routes/www or routes/admin.
- Each has a get / post / rest directory.
- Restful endpoints defined by exporting create, read, etc

Cron jobs
Front job handlers should be export a schedule attribute: a string “schedule expression” - exports.schedule = ‘0 * 10 * * * *’.  This runs every 10 seconds. 
To testa job: run node runcron <file name>

Queues

For long running or scheduled jobs, use a queue handler.
Thi is defined
Its run async by a queue worker
Routes/queue/file name

To add handler to queue call db.queue.post(file name, opts, secs)
Db.queue.post(‘file name”, { argument: ‘value’), 4700 for 1 hours

Test queue handlers locally by getting the. MsgID for the entry in queue table and run node run queue MSGID

Reports

Report handlers found in routes/report/… 
Check store page in admin
Respond with a file download or email sent if it will take longer

Scripts. 
Routes/run

Node run <file name with no extension >

Storage

Compiled data is cached as json files in file system
These files are generated by running ./cache ignore
They are stored local/osmosis/cache 

Grab-hub Neptune - quizbuilder question categories

Redid - cache arbitrary data to improve performance
Osmosis/redisStore has simple interface

MySQL

Local/osmosis/do

